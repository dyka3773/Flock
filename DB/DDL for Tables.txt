DROP TABLE IF EXISTS `Flock`.`Business_Personal`;
DROP TABLE IF EXISTS `Flock`.`Company`;
DROP TABLE IF EXISTS `Flock`.`Contacts_in_Groups`;
DROP TABLE IF EXISTS `Flock`.`Contacts`;
DROP TABLE IF EXISTS `Flock`.`Campaign`;
DROP TABLE IF EXISTS `Flock`.`Groups`;
DROP TABLE IF EXISTS `Flock`.`Accounts`;
DROP TABLE IF EXISTS `Flock`.`Frequencies`;

CREATE TABLE IF NOT EXISTS `Flock`.`Frequencies` (
  `FID` INT NOT NULL AUTO_INCREMENT,
  `F_Name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`FID`),
  CONSTRAINT thisFrequencyAlreadyExists UNIQUE(F_Name)
) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE IF NOT EXISTS `Flock`.`Accounts` (
  `AID` INT NOT NULL AUTO_INCREMENT,
  `Email` VARCHAR(45) NOT NULL,
  `Passwd` VARCHAR(45) NOT NULL,
  `Type` INT NOT NULL,
  `Num_of_Camps` INT(10) NOT NULL,
  `Num_of_Conts` INT(10) NOT NULL,
  `Num_of_Sent` INT(10) NOT NULL,
  PRIMARY KEY (`AID`),
  CONSTRAINT emailAlreadyExistsInDB UNIQUE (`Email`)
  )
COMMENT = '// If type = 0 then Account is Personal\n// If type = 1 then Account is Company';

CREATE TABLE IF NOT EXISTS `Flock`.`Business_Personal` (
  `AID` INT(11) NOT NULL,
  `F_Name` VARCHAR(45) NOT NULL,
  `L_Name` VARCHAR(45) NOT NULL,
  `Phone` VARCHAR(45) NOT NULL,
  `Gender` VARCHAR(45) NOT NULL,
  `Country` VARCHAR(45) NOT NULL,
  `ZIP` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`AID`),
  CONSTRAINT `fk_AID_from_Business_Personal` FOREIGN KEY (`AID`) REFERENCES `Accounts` (`AID`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE IF NOT EXISTS `Flock`.`Company` (
  `AID` INT(11) NOT NULL,
  `C_Name` VARCHAR(45) NOT NULL,
  `Phone` VARCHAR(45) NOT NULL,
  `Country` VARCHAR(45) NOT NULL,
  `ZIP` VARCHAR(45) NOT NULL,
  `Phy_Address` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`AID`),
  CONSTRAINT `fk_AID_from_Company` FOREIGN KEY (`AID`) REFERENCES `Accounts` (`AID`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE IF NOT EXISTS `Flock`.`Contacts` (
  `CID` INT NOT NULL AUTO_INCREMENT,
  `Full_Name` VARCHAR(45) NOT NULL,
  `Email` VARCHAR(45) NOT NULL,
  `AID` INT(11) NOT NULL,
  PRIMARY KEY (`CID`),
  CONSTRAINT emailAlreadyExistsInAccount UNIQUE (`Email`,`AID`),
  CONSTRAINT `fk_AID_from_Contacts` FOREIGN KEY (`AID`) REFERENCES `Accounts` (`AID`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE IF NOT EXISTS `Flock`.`Groups` (
  `GID` INT(11) NOT NULL AUTO_INCREMENT,
  `Group_Name` VARCHAR(45) NOT NULL,
  `AID` INT(11) NOT NULL,
  PRIMARY KEY (`GID`),
  CONSTRAINT groupAlreadyExistsInAccount UNIQUE (`Group_Name`,`AID`),
  CONSTRAINT `fk_AID_from_Groups` FOREIGN KEY (`AID`) REFERENCES `Accounts` (`AID`) ON DELETE CASCADE
) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE IF NOT EXISTS `Flock`.`Campaign` (
  `CAID` INT(11) NOT NULL AUTO_INCREMENT,
  `Subject` VARCHAR(100) NOT NULL,
  `Text` MEDIUMTEXT,
  `Start_Date` DATETIME NOT NULL,
  `End_Date` DATETIME DEFAULT NULL,
  `Creation_Date` DATETIME NOT NULL,
  `C_Name` VARCHAR(45) NOT NULL,
  `FID` INT(11) NOT NULL,
  `Num_of_Conts` INT(11) UNSIGNED ZEROFILL NOT NULL,
  `Attachment` BLOB,
  `AID` INT(11) NOT NULL,
  `GID` INT(11) NOT NULL,
  PRIMARY KEY (`CAID`),
  KEY `fk_AID_from_Camps` (`AID`),
  KEY `fk_GID_from_Camps` (`GID`),
  KEY `fk_FID_from_Camps` (`FID`),
  CONSTRAINT `fk_AID_from_Camps` FOREIGN KEY (`AID`) REFERENCES `Accounts` (`AID`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT `fk_GID_from_Camps` FOREIGN KEY (`GID`) REFERENCES `Groups` (`GID`) ON UPDATE NO ACTION,
  CONSTRAINT `fk_FID_from_Camps` FOREIGN KEY (`FID`) REFERENCES `Frequencies` (`FID`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT thisCnameAlreadyExistsInThisUser UNIQUE (`C_Name`,`AID`)
  ) ENGINE=INNODB DEFAULT CHARSET=UTF8MB4;

CREATE TABLE IF NOT EXISTS `Flock`.`Contacts_in_Groups` (
  `CID` INT NOT NULL,
  `GID` INT NOT NULL,
  PRIMARY KEY (`GID`, `CID`),
  CONSTRAINT `fk_GID_from_CiG`
    FOREIGN KEY (`GID`)
    REFERENCES `Flock`.`Groups` (`GID`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_CID_from_CiG`
    FOREIGN KEY (`CID`)
    REFERENCES `Flock`.`Contacts` (`CID`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION);
    
INSERT INTO `Flock`.`Frequencies`
(`F_Name`)
VALUES
('ONCE'),
('EVERY_DAY'),
('EVERY_WEEK'),
('EVERY_MONTH'),
('EVERY_YEAR'),
('30'),
('80');